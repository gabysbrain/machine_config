#! /usr/bin/env bash

if [[ $# -gt 1 && "$1" == "-d" ]]; then
  DEBUG=1
  shift
else
  DEBUG=
fi

set -eou pipefail

if [[ -n "$DEBUG" ]]; then
  set -x
fi

PROJ_DIRS=(~/projects ~/raicoon)

# make sure all PROJ_DIRS exist otherwise wakiness may ensue
pds=()
for pd in "${PROJ_DIRS[@]}"
do
  if [[ -d "$pd" ]]; then
    pds+=("$pd")
  else
    echo "warning: project dir ${pd} does not exist"
  fi
done
PROJ_DIRS=("${pds[@]}")

selected=$(find "${PROJ_DIRS[@]}" -name '.git' | sed 's#/\.git##' | fzf)

# if we don't select everything just quit
if [ -z "$selected" ]; then
  if [[ -n "$DEBUG" ]]; then
    echo "nothing selected, quitting"
  fi
  exit 0
fi

if [[ -n "$DEBUG" ]]; then
  tat -d "$selected"
else
  tat "$selected"
fi


